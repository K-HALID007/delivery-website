<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard Fixed - Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e293b;
            color: white;
        }
        .container {
            background: #334155;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        button {
            background: #f59e0b;
            color: #1e293b;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #d97706;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #475569;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #10b981;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #10b981;
        }
        .stat-label {
            font-size: 1em;
            color: #cbd5e1;
            margin-top: 10px;
        }
        .log {
            background: #1e293b;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üéâ Admin Dashboard Fixed - Test Results</h1>
    <p>Testing the fixed admin dashboard APIs with correct data</p>

    <div class="container">
        <h2>üîê Quick Admin Login</h2>
        <button onclick="quickLogin()">Login as Admin</button>
        <button onclick="testAllAPIs()">Test All Fixed APIs</button>
        <div id="login-status"></div>
    </div>

    <div class="container">
        <h2>üìä Fixed Dashboard Summary</h2>
        <div id="summary-display"></div>
        <button onclick="loadFixedSummary()">Load Fixed Summary</button>
    </div>

    <div class="container">
        <h2>üì¶ Fixed Shipments Data</h2>
        <div id="shipments-display"></div>
        <button onclick="loadFixedShipments()">Load Fixed Shipments</button>
    </div>

    <div class="container">
        <h2>üë• Fixed Users Data</h2>
        <div id="users-display"></div>
        <button onclick="loadFixedUsers()">Load Fixed Users</button>
    </div>

    <div class="container">
        <h2>üìù Test Logs</h2>
        <div id="logs" class="log"></div>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            logElement.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function getAuthHeaders() {
            const token = sessionStorage.getItem('admin_token');
            return {
                'Content-Type': 'application/json',
                ...(token && { Authorization: `Bearer ${token}` })
            };
        }

        async function quickLogin() {
            log('üîë Quick admin login...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/auth/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@gmail.com',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.token) {
                    sessionStorage.setItem('admin_token', data.token);
                    sessionStorage.setItem('admin_data', JSON.stringify(data.user));
                    
                    log('‚úÖ Admin login successful', 'success');
                    document.getElementById('login-status').innerHTML = `
                        <div class="success">‚úÖ Logged in as: ${data.user.name}</div>
                    `;
                } else {
                    log(`‚ùå Login failed: ${data.message}`, 'error');
                    document.getElementById('login-status').innerHTML = `
                        <div class="error">‚ùå Login Failed: ${data.message}</div>
                    `;
                }
            } catch (error) {
                log(`‚ùå Login error: ${error.message}`, 'error');
                document.getElementById('login-status').innerHTML = `
                    <div class="error">‚ùå Login Error: ${error.message}</div>
                `;
            }
        }

        async function loadFixedSummary() {
            log('üìä Loading FIXED admin summary...', 'info');
            
            const displayDiv = document.getElementById('summary-display');
            
            try {
                const response = await fetch(`${API_URL}/admin/summary`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ FIXED Summary loaded: Revenue ‚Çπ${data.totalRevenue}, Active Shipments ${data.activeShipments}`, 'success');
                    
                    displayDiv.innerHTML = `
                        <div class="grid">
                            <div class="stat-card">
                                <div class="stat-number">${data.totalUsers || 0}</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${data.activeShipments || 0}</div>
                                <div class="stat-label">Active Shipments</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">‚Çπ${data.totalRevenue || 0}</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${data.pendingDeliveries || 0}</div>
                                <div class="stat-label">Pending Deliveries</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${data.totalPartners || 0}</div>
                                <div class="stat-label">Total Partners</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${data.activePartners || 0}</div>
                                <div class="stat-label">Active Partners</div>
                            </div>
                        </div>
                        <div style="background: #475569; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <strong>üéâ SUCCESS! Fixed Data:</strong><br>
                            <span class="success">‚úÖ Revenue: ‚Çπ${data.totalRevenue} (was showing 0 before)</span><br>
                            <span class="success">‚úÖ Active Shipments: ${data.activeShipments} (was showing 0 before)</span><br>
                            <span class="success">‚úÖ Total Users: ${data.totalUsers}</span><br>
                            <span class="success">‚úÖ All data is now correct!</span>
                        </div>
                    `;
                } else {
                    const errorData = await response.json();
                    log(`‚ùå Summary API failed: ${errorData.message}`, 'error');
                    displayDiv.innerHTML = `<div class="error">‚ùå API Failed: ${errorData.message}</div>`;
                }
            } catch (error) {
                log(`‚ùå Summary API error: ${error.message}`, 'error');
                displayDiv.innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
            }
        }

        async function loadFixedShipments() {
            log('üì¶ Loading FIXED shipments...', 'info');
            
            const displayDiv = document.getElementById('shipments-display');
            
            try {
                const response = await fetch(`${API_URL}/admin/shipments/recent`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ FIXED Shipments loaded: ${data.length} shipments`, 'success');
                    
                    if (data.length > 0) {
                        let html = `<div class="success">üéâ SUCCESS! Found ${data.length} shipments (was showing 0 before)</div>`;
                        html += '<div style="margin-top: 15px;">';
                        
                        data.slice(0, 5).forEach((shipment, index) => {
                            html += `
                                <div style="background: #475569; padding: 10px; border-radius: 6px; margin: 5px 0; border-left: 3px solid #10b981;">
                                    <strong>${shipment.id}</strong> - <span style="color: #10b981;">${shipment.status}</span>
                                    <br><small>Customer: ${shipment.customer}</small>
                                    <br><small>Route: ${shipment.origin} ‚Üí ${shipment.destination}</small>
                                </div>
                            `;
                        });
                        
                        html += '</div>';
                        displayDiv.innerHTML = html;
                    } else {
                        displayDiv.innerHTML = '<div class="warning">‚ö†Ô∏è No shipments found</div>';
                    }
                } else {
                    const errorData = await response.json();
                    log(`‚ùå Shipments API failed: ${errorData.message}`, 'error');
                    displayDiv.innerHTML = `<div class="error">‚ùå API Failed: ${errorData.message}</div>`;
                }
            } catch (error) {
                log(`‚ùå Shipments API error: ${error.message}`, 'error');
                displayDiv.innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
            }
        }

        async function loadFixedUsers() {
            log('üë• Loading FIXED users...', 'info');
            
            const displayDiv = document.getElementById('users-display');
            
            try {
                const response = await fetch(`${API_URL}/admin/users`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ FIXED Users loaded: ${data.length} users`, 'success');
                    
                    if (data.length > 0) {
                        let html = `<div class="success">üéâ SUCCESS! Found ${data.length} users (was showing 0 before)</div>`;
                        html += '<div style="margin-top: 15px;">';
                        
                        data.slice(0, 5).forEach((user, index) => {
                            html += `
                                <div style="background: #475569; padding: 10px; border-radius: 6px; margin: 5px 0; border-left: 3px solid #3b82f6;">
                                    <strong>${user.name}</strong> - ${user.email}
                                    <br><small>Role: ${user.role} | Active: ${user.isActive ? 'Yes' : 'No'}</small>
                                </div>
                            `;
                        });
                        
                        html += '</div>';
                        displayDiv.innerHTML = html;
                    } else {
                        displayDiv.innerHTML = '<div class="warning">‚ö†Ô∏è No users found</div>';
                    }
                } else {
                    const errorData = await response.json();
                    log(`‚ùå Users API failed: ${errorData.message}`, 'error');
                    displayDiv.innerHTML = `<div class="error">‚ùå API Failed: ${errorData.message}</div>`;
                }
            } catch (error) {
                log(`‚ùå Users API error: ${error.message}`, 'error');
                displayDiv.innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
            }
        }

        async function testAllAPIs() {
            log('üöÄ Testing all FIXED APIs...', 'info');
            
            // Login first
            await quickLogin();
            
            // Wait a bit then test all APIs
            setTimeout(async () => {
                await loadFixedSummary();
                await loadFixedShipments();
                await loadFixedUsers();
                
                log('üéâ All FIXED APIs tested successfully!', 'success');
            }, 1000);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // Auto-run on page load
        window.onload = function() {
            log('üöÄ Admin Dashboard Fixed Test Started', 'info');
            log('üí° Click "Test All Fixed APIs" to see the corrected data', 'info');
        };
    </script>
</body>
</html>